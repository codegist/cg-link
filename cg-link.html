<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../cg-behaviors/cg-base-behavior.html">

<dom-module id="cg-link">
<style>
    :host {
        display: inline;
    }
    :host .link {
        @apply(--paper-font-caption);
        line-height: 14px!important;
        cursor:pointer;
        padding: 4px;
        margin: 0px 5px;
        display: inline-block;
        background-color: white;
        border-radius:5px;
        color: #6965FF;
    }
    :host([nowrap]) .link {
        white-space: nowrap
    }
</style>
<template>
    <paper-material animated class="link" on-tap="_click" id="link" elevation="[[z]]"><span>[[showLink.display]]</span></paper-material>
</template>
</dom-module>
<script>
    Polymer({
        is:'cg-link',
        properties:{
            z:{
                type:Number,
                value:1,
            },
            nowrap:{
                type:Boolean,
                value:false,
                reflectToAttribute:true
            },
            link:{
                type:Object,
                value:null
            },
            identifier:{
                type:Object,
                value:null
            },
            type:{
                type:String,
                value:null
            },
            display:{
                type:String,
                value:null
            },
            source:Object,
            linkdata:Object,
            linkSource:Object,
            callback:{
                type:Function,
                value:function(){return function(){}}
            },
            clicked:{
                type:Function,
                value:function(){
                    return this._clicked;
                }

            },
            showLink:{
                type:Object,
                computed:'buildLink(link, display, identifier, type)'
            }
        },
        behaviors:[CG.BaseBehavior],
        buildLink:function(link, display, identifier, type){
            var link = this.link || {
                                        display:display,
                                        id:identifier,
                                        type:type,
                                    };
            return link;
        },
        _click:function(e){
            e.stopPropagation();
            console.log(this.toString(), "firing link clicked (type:",this.showLink.type,", id:",this.showLink.id,")");
            this.clicked(e, {
                id:this.showLink.id,
                type:this.showLink.type,
                data:this.linkdata,
                linkSource:this.linkSource,
                original:this.link,
                callback:this.callbackWrapper
            });
        },
        _clicked:function(e, detail){
            this.fireApplicationLink(detail.type, detail, this.source);
        },
        callbackWrapper:function(response){
            console.log(this.toString(), "Receiving link response (type:",this.type,", subtype:",this.subtype,", id:",this.id,")");
            this.callback(response, this.showLink.id, this.showLink.type);
        }
    });
</script>